singularity {
	enabled = true
	cacheDir = "/home/proteomics/mygit/atlas-imgs"
}

params {

    executor='crg' 

    //Folders:
    databases_folder            = "/home/proteomics/mygit/atlas-databases"
    scripts_folder              = "$baseDir/bin"
    tools_folder                = "$baseDir/tools"  
    assets_folder               = "$baseDir/assets" 

    //API:
    url_api_signin              = "localhost:8089/api/auth/signin"
    url_api_insert_file         = "localhost:8089/api/file/insertFromPipelineRequest"
    url_api_insert_wetlab_data  = "localhost:8089/api/data/pipeline"
    url_api_insert_data         = "localhost:8089/api/data/pipelineRequest"
    url_api_insert_quant        = "localhost:8089/api/quantification/pipeline"
    url_api_fileinfo            = "localhost:8089/api/fileInfo/pipeline"
    url_api_insert_modif        = "localhost:8089/api/modification/pipeline"
    url_api_insert_wetlab_file  = "localhost:8089/api/file/insertFromPipeline"

    //API QCloud: 
    url_api_qcloud_signin             = "localhost:8089/api/auth"
    url_api_qcloud_insert_data        = "localhost:8089/api/data/pipeline"
    url_api_qcloud_insert_file        = "localhost:8089/api/file"
    
    // This should be at SECRETS!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    url_api_qcloud_user               = "roger.olivella@crg.eu"
    url_api_qcloud_pass               = "qcloud2017"
   

    //api-key for inserting standard QC params: 
    api_key_qc_params           = "453a2301-6698-43dd-baae-7eb4c6a5eaa5"

    //Default search engine: 
    search_engine                   = "comet"    

    //Quantification script (from CSV to JSON): 
    num_max_prots = 1000
   
    //DIA-NN: 
    qvalue 		            = "0.01" 
    min_fr_mz 			    = "350" 
    max_fr_mz 			    = "1850" 
    cut 			    = "K*,R*" 
    missed_cleavages	 	    = "1" 
    min_pep_len 		    = "7" 
    max_pep_len 		    = "30" 
    min_pr_mz 			    = "500" 
    max_pr_mz 			    = "900" 
    min_pr_charge	 	    = "1" 
    max_pr_charge 		    = "4" 
    var_mods 			    = "1" 
    var_mod 			    = "UniMod:35,15.994915,M" 
    pg_level 			    = "1" 

    //DIA-UMPIRE: 
    jar_file            = "$baseDir/tools/dia-umpire/DIA_Umpire_SE.jar"
    params_file         = "$baseDir/tools/dia-umpire/embo-diase-2.params"
    lib_folder          = "$baseDir/tools/dia-umpire/lib"

    //OpenMS Mascot adapter:  
    search_title              = "QSample"
    hostname                  = "mascot.linux.crg.es"
    host_port                 = "80" 
    server_path               = "mascot"
    timeout                   = "0" 
    precursor_mass_tolerance  = "'7'"
    precursor_error_units     = "ppm"
    fixed_modifications       = "'Carbamidomethyl (C)'"
    variable_modifications    = "'Oxidation (M)' 'Acetyl (N-term)'"
    enzyme                    = "'Trypsin'"    
    fragment_mass_tolerance   = "'0.5'"
    fragment_error_units      = "'Da'" 
    charges                   = "'2,3,4,5'"
    missed_cleavages          = "'3'"
    batch_size                = "50000"
    debug_code                = "1000"

    //OpenMS Comet engine adapter: 
    precursor_charge          = "2:5"
    comet_executable          = "$baseDir/tools/comet/comet.linux.2022.01.2.exe"

    //Other OpenMS modules: 

    //PeptideIndexer: 
    decoy_string             = "'###REV###'"
    decoy_string_position    = "'prefix'"
    missing_decoy_action     = "'warn'"
    unmatched_action         = "'remove'"
    aaa_max                  = "0"
    enzyme_specificity       = "full"

    //FalseDiscoveryRate:
    PSM                      = "'true'" 
    protein                  = "'false'"
    FDR_PSM                  = "'1'"
    FDR_protein              = "'1'"

    //IDFilter:
    score_pep                = "'0.05'"
    aaa_pep                  = "'0.0'"
    score_prot               = "'0.0'"
    aaa_prot                 = "'0.0'"
    black_regex              = "[XZ]+"

    //FeatureFinderMultiplex:
    algorithm_labels         = "''"
    algorithm_charge         = "'1:5'"
    algorithm_rt_typical     = "'40'"
    algorithm_rt_min         = "'2'"
    algorithm_mz_tolerance   = "'10'"
    algorithm_rt_band        = "'1'"
    
    //IDMapper:
    rt_tolerance             = "'40'"
    mz_tolerance             = "'10'"

    //ProteinQuantifier: 
    average                  = "'mean'"

    ////////////////////////////////////////////////////Testing!
    //EICExtractor   
    //eic_rt_tol               = "'240'"
    eic_rt_tol               = "'3600'"
    eic_mz_tol               = "'5'"

    //Secondary reactions:
    sec_react_modif           ="''"

}

process {

     cpus='1'
     scratch = false
     errorStrategy = 'retry'
     maxRetries = 3


     profiles {

         tiny {

                withLabel: comet {
                        container = 'openms/executables:latest'
                        cpus='1'
                        clusterOptions = '-l virtual_free=4G,h_rt=3600 -pe smp 1 -m abe'
                }

         }


         small {
      
     		withLabel: comet {
        		container = 'openms/executables:latest'
                        cpus='1'
        		clusterOptions = '-l virtual_free=8G,h_rt=3600 -pe smp 1 -m abe'
     		}

     	 }


          medium {

                withLabel: mascot {
                        container = 'openms/executables:latest'
                        clusterOptions = '-l virtual_free=8G,h_rt=10800'
                }


                withLabel: comet {
                        container = 'openms/executables:latest'
                        cpus='5'
                        clusterOptions = '-l virtual_free=8G,h_rt=10800 -pe smp 2 -m abe'
                }
   
                withLabel: diann {
      		  container = 'proteomicsunitcrg/dia-nn:prerelease'
        	  clusterOptions = '-l virtual_free=8G,h_rt=10800 -pe smp 2 -m abe'
     		}

         }


         big {

                withLabel: comet {
                        container = 'openms/executables:latest'
                        cpus='16'
                        clusterOptions = '-l virtual_free=16G -pe smp 16 -m abe'
                }

        }
 

     }


     withLabel: thermoconvert {
        container = 'quay.io/biocontainers/thermorawfileparser:1.2.3--1'
        clusterOptions = '-l virtual_free=9G,h_rt=3600'
     }

     withLabel: openms {
        container = 'openms/executables:latest'
        clusterOptions = '-l virtual_free=9G'
     }

     withLabel: eic {
        container = 'ghcr.io-openms-openms-executables-latest'
        clusterOptions = '-l virtual_free=9G'
     }

     withLabel: ffm {
        container = 'openms/executables:latest'
        clusterOptions = '-l virtual_free=9G'
     }

     withLabel: diaumpire {
        clusterOptions = '-l virtual_free=9G,h_rt=10800 -pe smp 5 -m abe'
     }

     withLabel: clitools {
        clusterOptions = '-l virtual_free=9G,h_rt=3600'
        container = 'proteomicsunitcrg/clitools:latest'
     }

}
